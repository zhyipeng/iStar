var se=Object.defineProperty;var oe=(s,e,t)=>e in s?se(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var f=(s,e,t)=>(oe(s,typeof e!="symbol"?e+"":e,t),t);import{r as w,a as q,E as L,d as A,c as E,b as k,o as y,e as $,f as a,u as h,t as S,g as c,w as _,h as ae,i as ne,s as re,F as U,j as D,k as V,p as le,l as ce,m as ie,n as ue,q as B,v as K,x as de,y as pe,z as _e,A as z,B as ge,C as he,D as fe,G as ve,V as Q,H as me,I as ye,J as Te,K as we}from"./vendor.3d2d53d8.js";const ke=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const v of i.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&n(v)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}};ke();function G(){return{username:"",avatar:"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png",followers:0,following:0}}const W="iStarUserInfo",be="iStarToken";class xe{constructor(){f(this,"token","");f(this,"accessToken","");f(this,"userinfo",w(G()));const e=localStorage.getItem(W);e&&(this.token=e)}setToken(e,t){localStorage.setItem(W,e),localStorage.setItem(be,t),this.token=e,this.accessToken=t}setUserInfo(e){this.userinfo.value=e}isLogin(){return this.token!==""}clearUserInfo(e=!0){this.userinfo.value=G(),this.token="",this.accessToken="",e&&window.location.reload()}}const Se=0,$e=1,Ee=2;class Re{constructor(){f(this,"repos",w([]));f(this,"filterTag",w(null));f(this,"filterLang",w(null));f(this,"filterUnTagged",w(!1));f(this,"sortBy",w(0));f(this,"selected",w(null));f(this,"tags",w([]));f(this,"repoTags",w({}))}filterBy(e="",t="",n=!1){this.filterTag.value=e===""?null:e,this.filterLang.value=t===""?null:t,this.filterUnTagged.value=n}sort(e){this.sortBy.value=e}setRepos(e){this.repos.value=e}getRepos(){return this.repos.value.filter(e=>{if(this.filterLang.value&&e.language!==this.filterLang.value)return!1;const t=this.getRepoTag(e.id);return!(this.filterTag.value&&t.indexOf(this.filterTag.value)===-1||this.filterUnTagged.value&&t.length!==0)}).sort((e,t)=>{switch(this.sortBy.value){case Se:return e.updated_at<t.updated_at?1:-1;case $e:return e.stargazers_count<t.stargazers_count?1:-1;case Ee:return e.name>t.name?1:-1;default:return e.updated_at<t.updated_at?1:-1}})}setTags(e){this.tags.value=e}addTag(e){this.tags.value.push({tag:e,repo_count:0})}setRepoTags(e){this.repoTags.value=e}setRepoTag(e,t){const n=this.repoTags.value[String(e)]||[];this.repoTags.value[String(e)]=t;const o=new Set(n),i=new Set(t);for(const d of this.tags.value)o.has(d.tag)&&(d.repo_count-=1),i.has(d.tag)&&(d.repo_count+=1);const v=new Set(this.tags.value.map(d=>d.tag));t.forEach(d=>{v.has(d)||this.tags.value.push({tag:d,repo_count:1})})}getRepoTag(e){const t=this.repoTags.value[String(e)];return t||[]}deleteTag(e){this.tags.value=this.tags.value.filter(n=>n.tag!==e);const t=this.repoTags.value;for(const n in t)t[n]=t[n].filter(o=>o!==e);this.repoTags.value=t}}class Ce{constructor(){f(this,"user",new xe);f(this,"repo",new Re)}}const r=new Ce;class Be{get isProdEnv(){return!0}get baseURL(){return this.isProdEnv?"":"http://localhost:8000"}getUrl(e){return`${this.baseURL}${e}`}}const X=new Be,R=q.create({baseURL:X.baseURL});R.interceptors.request.use(s=>{const{token:e}=r.user;return e&&(s.headers["x-token"]=e),s});R.interceptors.response.use(s=>(s.status===401&&r.user.clearUserInfo(),s.data),s=>(L.error(`\u8BF7\u6C42\u5F02\u5E38, \u8BF7\u7A0D\u540E\u91CD\u8BD5: ${s}`),Promise.reject(s)));const Ie=async()=>R({url:"/tag/"}),Le=async s=>R({url:"/tag/",data:{tag:s},method:"POST"}),Ue=async(s,e)=>R({url:"/tag/set_tag",method:"POST",data:{tags:s,repos:e}}),De=async()=>R({url:"/tag/get_repo_tags"}),Ae=async s=>R({url:"/tag/",data:{tag:s},method:"DELETE"});var F=(s=>(s.AddTag="add-tag",s.Sync="sync",s))(F||{});class Fe{constructor(){f(this,"handlers");this.handlers={}}register(e,t){this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t)}send(e,...t){const n=this.handlers[e];n&&n.forEach(o=>{o(...t)})}}const P=new Fe;var O=(s,e)=>{const t=s.__vccOpts||s;for(const[n,o]of e)t[n]=o;return t};const I=s=>(ie("data-v-23c4304a"),s=s(),ue(),s),Me={class:"container"},ze=["src"],Ve={class:"static-box"},Pe={class:"static-item"},Oe={class:"static-num"},je=I(()=>a("span",{class:"static-name"},"Starred",-1)),qe={class:"static-item"},Ne={class:"static-num"},He=I(()=>a("span",{class:"static-name"},"Followers",-1)),Ke={class:"static-item"},Ge={class:"static-num"},We=I(()=>a("span",{class:"static-name"},"Following",-1)),Je={class:"static-item"},Qe={class:"static-num"},Xe=I(()=>a("span",{class:"static-name"},"Manage",-1)),Ye={class:"static-item"},Ze={class:"static-num"},et=I(()=>a("span",{class:"static-name"},"Trending",-1)),tt={class:"static-item"},st={class:"static-num"},ot=I(()=>a("span",{class:"static-name"},"Search",-1)),at=B("All Repo"),nt=B("Untagged Repo"),rt=B("Tag"),lt={class:"menu-item-box"},ct={class:"count-item"},it=B("Language"),ut={class:"menu-item-box"},dt={class:"count-item"},pt={class:"footer"},_t=A({setup(s){const e=E(()=>r.user.userinfo.value),t=E(()=>r.repo.repos.value.length),n=E(()=>{const u={};r.repo.repos.value.forEach(l=>{l.language&&(u[l.language]||(u[l.language]=0),u[l.language]+=1)});const b=[];return Object.keys(u).forEach(l=>{b.push({lang:l,count:u[l]})}),b.sort((l,g)=>l.count<g.count?1:-1)}),o=E(()=>r.repo.tags.value),i=()=>{r.user.isLogin()||(r.user.clearUserInfo(!1),window.location.href=X.getUrl("/oauth/authorize"))},v=async u=>{switch(u){case"all_repo":r.repo.filterBy();break;case"untagged_repo":r.repo.filterBy("","",!0);break;default:u.startsWith("lang-")?r.repo.filterBy("",u.slice(5)):u.startsWith("tag-")?r.repo.filterBy(u.slice(4)):r.repo.filterBy()}},d=async()=>{try{const{value:u}=await K.prompt("\u65B0\u589E\u6807\u7B7E",{cancelButtonText:"\u53D6\u6D88",confirmButtonText:"\u63D0\u4EA4"});if(r.repo.tags.value.findIndex(b=>b.tag===u)!==-1){L.warning("\u5DF2\u5B58\u5728\u7684\u6807\u7B7E\u540D");return}await Le(u),r.repo.addTag(u)}catch(u){String(u)!=="cancel"&&L.error(String(u))}},p=async(u,b)=>{u.preventDefault();try{b.repo_count>0&&await K.confirm(`\u6807\u7B7E${b.tag}\u4ECD\u5728\u4F7F\u7528\u4E2D, \u662F\u5426\u7EE7\u7EED\u5220\u9664? `,{confirmButtonText:"\u662F",cancelButtonText:"\u5426"}),await Ae(b.tag),r.repo.deleteTag(b.tag)}catch(l){String(l)!=="cancel"&&L.error(String(l))}},T=()=>P.send(F.Sync);return(u,b)=>{const l=k("el-icon"),g=k("el-menu-item"),C=k("el-sub-menu"),j=k("el-menu");return y(),$("div",Me,[a("img",{class:"avatar",src:h(e).avatar,alt:"avatar",onClick:i},null,8,ze),a("div",Ve,[a("div",Pe,[a("span",Oe,S(h(t)),1),je]),a("div",qe,[a("span",Ne,S(h(e).followers),1),He]),a("div",Ke,[a("span",Ge,S(h(e).following),1),We]),a("div",Je,[a("span",Qe,[c(l,null,{default:_(()=>[c(h(ae))]),_:1})]),Xe]),a("div",Ye,[a("span",Ze,[c(l,null,{default:_(()=>[c(h(ne))]),_:1})]),et]),a("div",tt,[a("span",st,[c(l,null,{default:_(()=>[c(h(re))]),_:1})]),ot])]),c(j,{class:"menu-box","background-color":"#eee","default-active":"all_repo","text-color":"#555",onSelect:v},{default:_(()=>[c(g,{index:"all_repo"},{default:_(()=>[at]),_:1}),c(g,{index:"untagged_repo"},{default:_(()=>[nt]),_:1}),c(C,{index:"tag"},{title:_(()=>[rt]),default:_(()=>[(y(!0),$(U,null,D(h(o),x=>(y(),V(g,{index:`tag-${x.tag}`,key:x.tag,onContextmenu:M=>p(M,x)},{title:_(()=>[a("span",lt,[a("span",null,S(x.tag),1),a("span",ct,S(x.repo_count),1)])]),_:2},1032,["index","onContextmenu"]))),128))]),_:1}),c(C,{index:"language"},{title:_(()=>[it]),default:_(()=>[(y(!0),$(U,null,D(h(n),x=>(y(),V(g,{index:`lang-${x.lang}`,key:x.lang},{title:_(()=>[a("span",ut,[a("span",null,S(x.lang),1),a("span",dt,S(x.count),1)])]),_:2},1032,["index"]))),128))]),_:1})]),_:1}),a("div",pt,[c(l,{class:"btn",onClick:d},{default:_(()=>[c(h(le))]),_:1}),c(l,{class:"btn",onClick:T},{default:_(()=>[c(h(ce))]),_:1})])])}}});var gt=O(_t,[["__scopeId","data-v-23c4304a"]]);const ht={style:{overflow:"auto"}},ft=A({props:{repo:null},setup(s){const e=s,t=w("");return de(async()=>{if(!e.repo)return;const o=`${e.repo.url}/readme`,{data:i}=await q.get(o,{headers:{Accept:"application/vnd.github.v3+json",Authorization:`token ${r.user.accessToken}`}});t.value=pe.decode(i.content)}),(o,i)=>{const v=k("v-md-preview");return y(),$("div",ht,[c(v,{text:t.value},null,8,["text"])])}}});const vt={class:"repo-item"},mt={class:"info"},yt=["src"],Tt={class:"repo-name"},wt={class:"description"},kt={class:"footer"},bt={class:"language"},xt={class:"star"},St=A({props:{repo:null},setup(s){const e=s,t=E(()=>e.repo.owner?e.repo.owner.avatar_url:""),n=E(()=>{const o=r.repo.repoTags.value[String(e.repo.id)];return o||[]});return(o,i)=>{const v=k("el-tag");return y(),$("div",vt,[a("div",mt,[a("img",{class:"avatar",src:h(t),alt:"avatar"},null,8,yt),a("span",Tt,S(s.repo.name),1)]),a("p",wt,S(s.repo.description),1),a("div",kt,[a("span",bt,[a("span",null,S(s.repo.language),1),(y(!0),$(U,null,D(h(n),d=>(y(),V(v,{class:"tag",key:d},{default:_(()=>[B(S(d),1)]),_:2},1024))),128))]),a("span",xt," \u2B50\uFE0F "+S(s.repo.stargazers_count),1)])])}}});var $t=O(St,[["__scopeId","data-v-09615e22"]]);class Et{constructor(){f(this,"options",{menus:[{name:"\u6253\u6807\u7B7E",onclick:e=>{P.send(F.AddTag,e)}},{name:"GitHub",onclick:e=>{window.open(`${e.html_url}`,"_blank")}}]});f(this,"element");f(this,"selectedRepo",null);const e=document.createElement("ul");e.classList.add("context-menu");const{menus:t}=this.options;t.forEach(o=>{const i=document.createElement("li");i.textContent=o.name,i.onclick=()=>{this.selectedRepo&&o.onclick(this.selectedRepo),this.hide()},e.appendChild(i)}),document.querySelector("body").appendChild(e),this.element=e,this.hide()}show(e,t){this.selectedRepo=e;const n=this.element;n.style.position="absolute",n.style.top=`${t.clientY}px`,n.style.left=`${t.clientX}px`,n.style.display="block"}hide(){const e=this.element;e.style.display="none"}}const Y=new Et;const Rt={class:"container"},Ct={class:"sort-btn-group"},Bt={class:"repo-list"},It=["onClick","onContextmenu"],Lt={style:{display:"flex","justify-content":"flex-end",width:"100%"}},Ut=B("\u786E\u5B9A"),Dt=A({setup(s){const e=E(()=>r.repo.getRepos()),t=l=>{r.repo.sort(l)},n=l=>r.repo.sortBy.value===l,o=l=>r.repo.selected.value&&r.repo.selected.value.id===l.id,i=l=>{console.log(l),r.repo.selected.value=l},v=(l,g)=>{g.preventDefault(),Y.show(l,g)},d=w(!1),p=w(null),T=w([]),u=async l=>{p.value=l,T.value=r.repo.getRepoTag(l.id),d.value=!0},b=async()=>{if(!!p.value)try{await Ue(T.value,[p.value.id]),d.value=!1,r.repo.setRepoTag(p.value.id,T.value)}catch(l){L.error(String(l))}};return P.register(F.AddTag,u),(l,g)=>{const C=k("el-icon"),j=k("el-option"),x=k("el-select"),M=k("el-form-item"),Z=k("el-button"),ee=k("el-form"),te=k("el-dialog");return y(),$("div",Rt,[a("div",Ct,[c(C,{class:z(["sort-btn",{"active-btn":n(0)}]),size:25,onClick:g[0]||(g[0]=m=>t(0))},{default:_(()=>[c(h(_e))]),_:1},8,["class"]),c(C,{class:z(["sort-btn",{"active-btn":n(1)}]),size:25,onClick:g[1]||(g[1]=m=>t(1))},{default:_(()=>[c(h(ge))]),_:1},8,["class"]),c(C,{class:z(["sort-btn",{"active-btn":n(2)}]),size:25,onClick:g[2]||(g[2]=m=>t(2))},{default:_(()=>[c(h(he))]),_:1},8,["class"])]),a("ul",Bt,[(y(!0),$(U,null,D(h(e),m=>(y(),$("li",{class:z(["repo-list-item",{"active-item":o(m)}]),key:m.id,onClick:H=>i(m),onContextmenu:H=>v(m,H)},[c($t,{repo:m},null,8,["repo"])],42,It))),128))]),c(te,{modelValue:d.value,"onUpdate:modelValue":g[4]||(g[4]=m=>d.value=m),title:p.value?p.value.name:""},{default:_(()=>[c(ee,null,{default:_(()=>[c(M,null,{default:_(()=>[c(x,{modelValue:T.value,"onUpdate:modelValue":g[3]||(g[3]=m=>T.value=m),multiple:"","allow-create":"",filterable:"",style:{width:"100%"}},{default:_(()=>[(y(!0),$(U,null,D(h(r).repo.tags.value,m=>(y(),V(j,{key:m.tag,label:m.tag,value:m.tag},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),c(M,null,{default:_(()=>[a("div",Lt,[c(Z,{type:"primary",onClick:b},{default:_(()=>[Ut]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}});var At=O(Dt,[["__scopeId","data-v-588d0d36"]]);function J(s){const t=window.location.search.substring(1).split("&");let n="";return t.forEach(o=>{const i=o.split("="),[v,d]=i;v===s&&(n=d)}),n}const Ft=async()=>R({url:"/user/userinfo"});const Mt=A({setup(s){const e=E(()=>r.repo.selected.value),t=()=>{Y.hide()},n=async()=>{const p=await Ft();r.user.setUserInfo(p)},o=async()=>{let p=1,T=[];try{for(;p<10;){const{data:u}=await q.get(`https://api.github.com/users/${r.user.userinfo.value.username}/starred?per_page=100&page=${p}`,{headers:{accept:"application/vnd.github.v3+json",Authorization:`token ${r.user.accessToken}`}});if(T=T.concat(u),!u||u.length<100)break;p+=1}r.repo.setRepos(T)}catch(u){console.error(u)}},i=async()=>{const p=await Ie();r.repo.setTags(p)},v=async()=>{const p=await De();r.repo.setRepoTags(p)},d=async()=>{const p=ve.service();try{await n(),await Promise.all([o(),i(),v()])}finally{p.close()}};return P.register(F.Sync,d),fe(async()=>{const p=J("sign"),T=J("token");p?(r.user.setToken(p,T),window.location.href="/"):r.user.isLogin()&&await d()}),(p,T)=>(y(),$("div",{class:"main-container",onClick:t},[c(gt,{class:"left-side"}),c(At,{class:"repo-list"}),c(ft,{repo:h(e),class:"detail"},null,8,["repo"])]))}});var zt=O(Mt,[["__scopeId","data-v-0ecc8cb8"]]);Q.use(me,{Hljs:ye});const N=Te(zt);N.use(we);N.use(Q);N.mount("#app");
